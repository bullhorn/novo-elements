@if (label) {
  <h6 class="novo-section-header">
    <span (click)="toggle($event)" [class.clickable]="collapsible">
      @if (icon && !collapsible) {
        <i [ngClass]="icon" [attr.data-automation-id]="'novo-control-group-icon-' + key"></i>
      }
      @if (collapsible) {
        <i class="bhi-next" [class.toggled]="toggled"
          [attr.data-automation-id]="'novo-control-group-collapse-' + key"></i>
      }
      <span [attr.data-automation-id]="'novo-control-group-label-' + key">{{ label }}</span>
    </span>
    @if (description) {
      <label class="novo-control-group-description"
        [attr.data-automation-id]="'novo-control-group-description-' + key">{{ description }}</label>
    }
  </h6>
}
<div class="novo-control-group-controls" [class.vertical]="vertical" [class.horizontal]="!vertical"
  [class.hidden]="collapsible && !toggled">

  <ng-template #defaultTemplate let-index="index" let-form="form" let-key="key">
    <div class="novo-control-group-control">
      @for (c of controls; track c) {
        <div class="novo-control-container {{c.key}}"
          [class.is-label]="c.controlType === 'read-only'" [style.max-width.px]="c.width">
          <novo-control (change)="onChange()" [form]="(form?.controls)[key]['controls'][index]" [control]="c"
            [condensed]="!vertical || c.controlType === 'read-only'"></novo-control>
        </div>
      }
      @if (edit && !vertical) {
        <div class="novo-control-container edit last">
          @if (edit && !vertical) {
            <novo-button class="control-group-action" [disabled]="!disabledArray[index].edit" type="button"
              theme="icon" [icon]="editIcon"
              (click)="editControl(index)" [attr.data-automation-id]="'novo-control-group-edit-' + key" index="-1">
            </novo-button>
          }
        </div>
      }
      @if (remove && !vertical) {
        <div class="novo-control-container remove last">
          @if (remove && !vertical) {
            <novo-button class="control-group-action" [disabled]="!disabledArray[index].remove" type="button"
              theme="icon"
              [icon]="removeIcon" (click)="removeControl(index)"
              [attr.data-automation-id]="'novo-control-group-delete-' + key"
              index="-1">
            </novo-button>
          }
        </div>
      }
    </div>
    @if (edit && vertical) {
      <novo-button class="control-group-action" [disabled]="!disabledArray[index].edit" type="button"
        theme="icon" [icon]="editIcon"
        (click)="editControl(index)" [attr.data-automation-id]="'novo-control-group-edit-' + key" index="-1">
      </novo-button>
    }
    @if (remove && vertical) {
      <novo-button class="control-group-action" [disabled]="!disabledArray[index].remove" type="button"
        theme="icon"
        [icon]="removeIcon" (click)="removeControl(index)"
        [attr.data-automation-id]="'novo-control-group-delete-' + key"
        index="-1">
      </novo-button>
    }
  </ng-template>

  <ng-template #defaultColumnLabelTemplate let-form="form" let-key="key">
    @for (label of controlLabels; track label) {
      <div
        class="novo-control-group-control-label {{ label.key }}"
        [class.novo-control-group-control-hidden]="label.hidden"
        [style.max-width.px]="label.width" [class.column-required]="label.required">
        <span [attr.data-automation-id]="'novo-control-group-label-' + label.value">{{ label.value }}</span>
      </div>
    }
    @if (edit) {
      <div class="novo-control-group-control-label edit last"
      [attr.data-automation-id]="'novo-control-group-edit-' + key"></div>
    }
    @if (remove) {
      <div class="novo-control-group-control-label remove last"
      [attr.data-automation-id]="'novo-control-group-delete-' + key"></div>
    }
  </ng-template>

  @if (!vertical && (form?.controls)[key] && (form?.controls)[key]['controls'].length !== 0) {
    <div class="novo-control-group-labels">
      <ng-template [ngTemplateOutlet]="columnLabelTemplate || defaultColumnLabelTemplate"
        [ngTemplateOutletContext]="{ form: form, key: key, controlLabels: controlLabels }">
      </ng-template>
    </div>
  }

  @if ((form?.controls)[key]) {
    @for (control of (form?.controls)[key]['controls']; track control; let index = $index) {
      <div class="novo-control-group-row">
        <ng-template [ngTemplateOutlet]="rowTemplate || defaultTemplate"
          [ngTemplateOutletContext]="{ form: form, formGroup: control, index: index, key: key, controls: controls }">
        </ng-template>
      </div>
    }
  }

  @if ((form?.controls)[key] && (form?.controls)[key]['controls'].length === 0) {
    <div class="novo-control-group-empty" [attr.data-automation-id]="'novo-control-group-empty-' + key">
      {{ emptyMessage }}
    </div>
  }

  @if (add) {
    <div class="novo-control-group-footer">
      <novo-button type="button" theme="dialogue" icon="add-thin" side="left" (click)="onClickAdd()"
        [attr.data-automation-id]="'novo-control-group-bottom-add-' + key" index="-1">
        {{ add?.label }}
      </novo-button>
    </div>
  }
</div>
